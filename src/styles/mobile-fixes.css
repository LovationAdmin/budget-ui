/* src/styles/mobile-fixes.css - VERSION OPTIMISÉE COMPLÈTE */

/* ============================================================================
   1. CRITICAL MOBILE FIXES (Google Compliance)
   ============================================================================ */

/* Prevent font scaling issues in landscape on iOS */
html {
  -webkit-text-size-adjust: 100%;
}

/* Ensure body doesn't cause horizontal scroll */
body {
  width: 100%;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* ============================================================================
   2. IOS INPUT ZOOM FIX (The most important UX fix)
   ============================================================================ */

@media screen and (max-width: 768px) {
  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="number"],
  input[type="date"],
  input[type="tel"],
  select,
  textarea {
    font-size: 16px !important; 
  }
}

/* ============================================================================
   3. TAP HIGHLIGHT REMOVAL
   ============================================================================ */

* {
  -webkit-tap-highlight-color: transparent;
}

::selection {
  background-color: rgba(102, 126, 234, 0.2);
  color: inherit;
}

::-moz-selection {
  background-color: rgba(102, 126, 234, 0.2);
  color: inherit;
}

/* ============================================================================
   4. TOUCH TARGET HELPERS
   ============================================================================ */

.touch-target-extend {
  position: relative;
}

.touch-target-extend::after {
  content: '';
  position: absolute;
  top: -10px;
  bottom: -10px;
  left: -10px;
  right: -10px;
}

/* ✅ Minimum touch targets sur mobile */
@media (pointer: coarse) {
  button,
  a[role="button"],
  [role="button"] {
    min-height: 44px;
    min-width: 44px;
  }
}

/* ============================================================================
   5. RESPONSIVE UTILS
   ============================================================================ */

img, video {
  max-width: 100%;
  height: auto;
}

[data-radix-popper-content-wrapper] {
  max-width: 100vw !important;
}

@media screen and (max-width: 768px) {
  [role="dialog"],
  [role="alertdialog"] {
    max-width: calc(100vw - 2rem) !important;
    max-height: calc(100vh - 2rem) !important;
  }
}

/* ============================================================================
   6. SAFE AREA INSETS (iPhone notch/Dynamic Island)
   ============================================================================ */

@supports (padding-top: env(safe-area-inset-top)) {
  body {
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
  }

  .navbar-fixed-top {
    padding-top: max(1rem, env(safe-area-inset-top));
  }

  .bottom-sheet,
  [role="dialog"][data-position="bottom"] {
    padding-bottom: max(1rem, env(safe-area-inset-bottom));
  }
}

/* ============================================================================
   7. SCROLL BEHAVIOR OPTIMIZATIONS
   ============================================================================ */

@media (prefers-reduced-motion: no-preference) {
  html {
    scroll-behavior: smooth;
  }
}

.scrollable,
[role="dialog"],
.overflow-y-auto {
  -webkit-overflow-scrolling: touch;
}

/* ============================================================================
   8. KEYBOARD & FOCUS IMPROVEMENTS
   ============================================================================ */

@media (pointer: coarse) {
  :focus-visible {
    outline: 3px solid rgba(102, 126, 234, 0.5);
    outline-offset: 2px;
  }
}

:focus:not(:focus-visible) {
  outline: none;
}

/* ============================================================================
   9. PREVENT ACCIDENTAL ZOOMS
   ============================================================================ */

@media (pointer: coarse) {
  button,
  a,
  input,
  select,
  textarea {
    touch-action: manipulation;
  }
}

/* ============================================================================
   10. LOADING & SKELETON OPTIMIZATIONS
   ============================================================================ */

@media screen and (max-width: 768px) {
  .skeleton,
  [data-skeleton] {
    background: linear-gradient(
      90deg,
      rgba(229, 231, 235, 0.4) 0%,
      rgba(229, 231, 235, 0.8) 50%,
      rgba(229, 231, 235, 0.4) 100%
    );
    background-size: 200% 100%;
    animation: skeleton-shimmer 1.5s ease-in-out infinite;
  }

  @keyframes skeleton-shimmer {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }
}

/* ============================================================================
   11. ACCESSIBILITY IMPROVEMENTS
   ============================================================================ */

@media (prefers-contrast: high) {
  button,
  a {
    border: 2px solid currentColor;
  }
}

@media (prefers-color-scheme: dark) {
  ::selection {
    background-color: rgba(102, 126, 234, 0.4);
  }
}

/* ============================================================================
   12. PERFORMANCE OPTIMIZATIONS
   ============================================================================ */

@media (pointer: coarse) {
  .animate-slide-up,
  .animate-fade-in,
  .animate-scale-in {
    will-change: transform, opacity;
    transform: translateZ(0);
    backface-visibility: hidden;
  }
}

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* ============================================================================
   13. ✅ NOUVEAUX BREAKPOINTS - XS (320-480px)
   ============================================================================ */

/* Très petits écrans (iPhone SE, petits Android) */
@media screen and (max-width: 480px) {
  /* Réduire les paddings/margins pour gagner de l'espace */
  .p-4 { padding: 0.75rem !important; }
  .p-3 { padding: 0.5rem !important; }
  .gap-3 { gap: 0.5rem !important; }
  .gap-4 { gap: 0.75rem !important; }
  
  /* Réduire la taille des titres */
  h1 { font-size: 1.5rem !important; }
  h2 { font-size: 1.25rem !important; }
  h3 { font-size: 1.1rem !important; }
  
  /* Boutons full-width sur très petits écrans */
  .btn-group-mobile {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .btn-group-mobile > button {
    width: 100%;
  }
}

/* ============================================================================
   14. ✅ FIXES SPÉCIFIQUES BUDGET FAMILLE
   ============================================================================ */

/* Fix pour ChargesSection - Actions toujours visibles sur mobile */
@media (pointer: coarse) {
  /* Forcer l'affichage des boutons d'action sur mobile */
  .group .group-hover\:opacity-100 {
    opacity: 1 !important;
  }
}

/* Fix pour les inputs date trop étroits */
@media screen and (max-width: 640px) {
  /* Forcer 1 colonne pour les dates sur mobile */
  .grid-cols-2 {
    grid-template-columns: repeat(1, minmax(0, 1fr)) !important;
  }
}

/* Fix pour les badges qui débordent */
@media screen and (max-width: 480px) {
  /* Wrap des badges sur plusieurs lignes si nécessaire */
  .flex-wrap-mobile {
    flex-wrap: wrap;
  }
  
  /* Réduire la taille des badges */
  .badge-mobile-sm {
    font-size: 0.65rem !important;
    padding: 0.125rem 0.375rem !important;
  }
}

/* Fix pour MonthlyTable - Scroll horizontal smooth */
@media screen and (max-width: 768px) {
  .table-container {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
  }
  
  .table-container::-webkit-scrollbar {
    height: 6px;
  }
  
  .table-container::-webkit-scrollbar-thumb {
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 3px;
  }
}

/* Fix pour les Popovers trop larges sur mobile */
@media screen and (max-width: 640px) {
  [data-radix-popover-content] {
    max-width: calc(100vw - 2rem) !important;
  }
}

/* ============================================================================
   15. ✅ UTILITY CLASSES MOBILES
   ============================================================================ */

/* Classes pour cacher/montrer selon le device */
.mobile-only {
  display: none;
}

@media (pointer: coarse) {
  .mobile-only {
    display: block;
  }
  
  .desktop-only {
    display: none !important;
  }
}

/* Spacing réduit sur mobile */
@media screen and (max-width: 640px) {
  .mobile-compact {
    padding: 0.5rem !important;
    gap: 0.5rem !important;
  }
}

/* Touch-friendly spacing */
.touch-spacing {
  padding: 0.75rem;
}

@media (pointer: fine) {
  .touch-spacing {
    padding: 0.5rem;
  }
}