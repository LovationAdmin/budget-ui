/* src/styles/mobile-fixes.css - VERSION OPTIMISÉE */

/* ============================================================================
   1. CRITICAL MOBILE FIXES (Google Compliance)
   ============================================================================ */

/* Prevent font scaling issues in landscape on iOS */
html {
  -webkit-text-size-adjust: 100%;
  /* overflow-x: hidden here can sometimes break sticky headers, 
     better to handle overflow on specific containers */
}

/* Ensure body doesn't cause horizontal scroll */
body {
  width: 100%;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale; /* ✅ AJOUT : Meilleur rendu sur Firefox macOS */
}

/* ============================================================================
   2. IOS INPUT ZOOM FIX (The most important UX fix)
   ============================================================================ */

/* Forces inputs to 16px on mobile to prevent iOS from zooming in when you tap them.
   We use a media query so desktop users still get your smaller text designs.
*/
@media screen and (max-width: 768px) {
  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="number"],
  input[type="date"],
  input[type="tel"],
  select,
  textarea {
    font-size: 16px !important; 
  }
}

/* ============================================================================
   3. TAP HIGHLIGHT REMOVAL
   ============================================================================ */

/* Removes the grey background when tapping links on mobile */
* {
  -webkit-tap-highlight-color: transparent;
}

/* ✅ AJOUT : Améliorer la sélection de texte sur mobile */
::selection {
  background-color: rgba(102, 126, 234, 0.2);
  color: inherit;
}

::-moz-selection {
  background-color: rgba(102, 126, 234, 0.2);
  color: inherit;
}

/* ============================================================================
   4. TOUCH TARGET HELPERS (Utility classes)
   ============================================================================ */

/* Instead of forcing ALL buttons to be large, add this class 
   only to specific elements Google complains about.
   It creates an invisible hit area around the element.
*/
.touch-target-extend {
  position: relative;
}

.touch-target-extend::after {
  content: '';
  position: absolute;
  top: -10px;
  bottom: -10px;
  left: -10px;
  right: -10px;
}

/* ✅ AJOUT : Touch-friendly buttons minimum size */
@media (pointer: coarse) {
  button,
  a[role="button"],
  [role="button"] {
    min-height: 44px;
    min-width: 44px;
  }
}

/* ============================================================================
   5. RESPONSIVE UTILS
   ============================================================================ */

/* Ensure images never overflow their container */
img, video {
  max-width: 100%;
  height: auto;
}

/* Fix for Radix UI Dialogs/Sheets on very narrow screens */
[data-radix-popper-content-wrapper] {
  max-width: 100vw !important;
}

/* ✅ AJOUT : Fix pour les Radix Dialogs sur mobile */
@media screen and (max-width: 768px) {
  [role="dialog"],
  [role="alertdialog"] {
    max-width: calc(100vw - 2rem) !important;
    max-height: calc(100vh - 2rem) !important;
  }
}

/* ============================================================================
   6. SAFE AREA INSETS (iPhone notch/Dynamic Island support)
   ============================================================================ */

/* ✅ AJOUT : Support pour les encoches iPhone et Dynamic Island */
@supports (padding-top: env(safe-area-inset-top)) {
  body {
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
  }

  /* Navbar fixe avec safe area */
  .navbar-fixed-top {
    padding-top: max(1rem, env(safe-area-inset-top));
  }

  /* Bottom sheets avec safe area */
  .bottom-sheet,
  [role="dialog"][data-position="bottom"] {
    padding-bottom: max(1rem, env(safe-area-inset-bottom));
  }
}

/* ============================================================================
   7. SCROLL BEHAVIOR OPTIMIZATIONS
   ============================================================================ */

/* ✅ AJOUT : Smooth scrolling natif */
@media (prefers-reduced-motion: no-preference) {
  html {
    scroll-behavior: smooth;
  }
}

/* ✅ AJOUT : Momentum scrolling sur iOS */
.scrollable,
[role="dialog"],
.overflow-y-auto {
  -webkit-overflow-scrolling: touch;
}

/* ============================================================================
   8. KEYBOARD & FOCUS IMPROVEMENTS
   ============================================================================ */

/* ✅ AJOUT : Meilleure visibilité du focus sur mobile */
@media (pointer: coarse) {
  :focus-visible {
    outline: 3px solid rgba(102, 126, 234, 0.5);
    outline-offset: 2px;
  }
}

/* ✅ AJOUT : Cacher le focus au tap, mais le montrer au clavier */
:focus:not(:focus-visible) {
  outline: none;
}

/* ============================================================================
   9. PREVENT ACCIDENTAL ZOOMS
   ============================================================================ */

/* ✅ AJOUT : Empêcher le zoom double-tap sur les éléments interactifs */
@media (pointer: coarse) {
  button,
  a,
  input,
  select,
  textarea {
    touch-action: manipulation;
  }
}

/* ============================================================================
   10. LOADING & SKELETON OPTIMIZATIONS
   ============================================================================ */

/* ✅ AJOUT : Améliorer l'apparence des skeletons sur mobile */
@media screen and (max-width: 768px) {
  .skeleton,
  [data-skeleton] {
    background: linear-gradient(
      90deg,
      rgba(229, 231, 235, 0.4) 0%,
      rgba(229, 231, 235, 0.8) 50%,
      rgba(229, 231, 235, 0.4) 100%
    );
    background-size: 200% 100%;
    animation: skeleton-shimmer 1.5s ease-in-out infinite;
  }

  @keyframes skeleton-shimmer {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }
}

/* ============================================================================
   11. ACCESSIBILITY IMPROVEMENTS
   ============================================================================ */

/* ✅ AJOUT : Support pour les modes de contraste élevé */
@media (prefers-contrast: high) {
  button,
  a {
    border: 2px solid currentColor;
  }
}

/* ✅ AJOUT : Support pour le mode sombre système */
@media (prefers-color-scheme: dark) {
  ::selection {
    background-color: rgba(102, 126, 234, 0.4);
  }
}

/* ============================================================================
   12. PERFORMANCE OPTIMIZATIONS
   ============================================================================ */

/* ✅ AJOUT : GPU acceleration pour animations sur mobile */
@media (pointer: coarse) {
  .animate-slide-up,
  .animate-fade-in,
  .animate-scale-in {
    will-change: transform, opacity;
    transform: translateZ(0);
    backface-visibility: hidden;
  }
}

/* ✅ AJOUT : Désactiver les animations si demandé par l'utilisateur */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}